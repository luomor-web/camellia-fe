(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-129635ac"],{b5ce:function(t,e,a){},ce5b:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t._self._c;return e("a-modal",{staticStyle:{top:"12%",height:"90%","overflow-y":"hidden"},attrs:{width:t.modalWidth,visible:t.visible,title:t.title,cancelText:"关闭",wrapClassName:"ant-modal-cust-warp"},on:{ok:t.handleSubmit,cancel:t.close}},[e("a-row",{staticStyle:{padding:"10px",margin:"-10px"},attrs:{gutter:10}},[e("a-col",{attrs:{md:24,sm:24}},[e("div",{staticClass:"table-page-search-wrapper"},[e("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onSearch.apply(null,arguments)}}},[e("a-row",{attrs:{gutter:24}},[e("a-col",{attrs:{md:12,sm:24}},[e("a-form-item",{attrs:{labelCol:t.labelCol,wrapperCol:t.wrapperCol,label:"批号"}},[e("a-input",{ref:"name",attrs:{placeholder:"请输入批号"},model:{value:t.queryParam.name,callback:function(e){t.$set(t.queryParam,"name",e)},expression:"queryParam.name"}})],1)],1),e("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[e("a-col",{attrs:{md:12,sm:24}},[e("a-button",{attrs:{type:"primary"},on:{click:function(e){return t.loadData(1)}}},[t._v("查询")]),e("a-button",{staticStyle:{"margin-left":"8px"},on:{click:function(e){return t.searchReset(1)}}},[t._v("重置")]),e("span",{staticStyle:{"margin-left":"20px"}},[t._v("提示：双击行可以直接选中")])],1)],1)],1)],1),e("a-table",{ref:"table",attrs:{scroll:t.scrollTrigger,size:"middle",rowKey:"id",columns:t.columns,dataSource:t.dataSource,rowSelection:{selectedRowKeys:t.selectedRowKeys,onChange:t.onSelectChange,type:t.getType},loading:t.loading,customRow:t.rowAction}})],1)])],1)],1)},i=[],r=(a("0fea"),a("4ec3")),o=a("b65a"),n={name:"JSelectBatchModal",mixins:[o["a"]],components:{},props:["rows","multi","barCode"],data:function(){return{modalWidth:1100,queryParam:{name:"",depotItemId:"",depotId:"",barCode:""},labelCol:{xs:{span:24},sm:{span:5}},wrapperCol:{xs:{span:24},sm:{span:16}},categoryTree:[],columns:[{dataIndex:"batchNumber",title:"批号",width:100,align:"left",ellipsis:!0},{dataIndex:"barCode",title:"条码",width:100,ellipsis:!0},{dataIndex:"name",title:"名称",width:100,ellipsis:!0},{dataIndex:"standard",title:"规格",width:80,ellipsis:!0},{dataIndex:"model",title:"型号",width:80,ellipsis:!0},{dataIndex:"commodityUnit",title:"单位",width:60,ellipsis:!0},{dataIndex:"expirationDateStr",title:"有效期至",width:80},{dataIndex:"totalNum",title:"库存",width:80}],scrollTrigger:{},dataSource:[],selectedRowKeys:[],selectRows:[],selectIds:[],title:"选择批号",isorter:{column:"createTime",order:"desc"},departTree:[],depotList:[],visible:!1,form:this.$form.createForm(this),loading:!1,expandedKeys:[]}},computed:{getType:function(){return 1==this.multi?"checkbox":"radio"}},watch:{barCode:{immediate:!0,handler:function(){this.initBarCode()}}},created:function(){this.loadData()},methods:{initBarCode:function(){this.barCode?this.$emit("initComp",this.barCode):this.$emit("initComp","")},loadData:function(t){var e=this;if(this.rows&&JSON.parse(this.rows).depotId&&JSON.parse(this.rows).barCode){var a=JSON.parse(this.rows).id;a.length<=19&&(this.queryParam.depotItemId=a-0),this.queryParam.depotId=JSON.parse(this.rows).depotId-0,this.queryParam.barCode=JSON.parse(this.rows).barCode}1===t&&(this.ipagination.current=1),this.loading=!0;var s=this.getQueryParams();Object(r["db"])(s).then((function(t){t&&200===t.code&&(e.dataSource=t.data.rows,e.ipagination.total=t.data.total)})).finally((function(){e.loading=!1}))},showModal:function(){var t=this;this.visible=!0,this.$nextTick((function(){return t.$refs.name.focus()})),this.loadData(),this.form.resetFields()},getQueryParams:function(){var t=Object.assign({},this.queryParam,this.isorter);return t},getQueryField:function(){for(var t="id,",e=0;e<this.columns.length;e++)t+=","+this.columns[e].dataIndex;return t},searchReset:function(t){var e=this;if(0!==t){if(this.rows&&(this.queryParam.name="",JSON.parse(this.rows).depotId&&JSON.parse(this.rows).barCode)){var a=JSON.parse(this.rows).id;a.length<=19&&(this.queryParam.depotItemId=a-0),this.queryParam.depotId=JSON.parse(this.rows).depotId-0,this.queryParam.barCode=JSON.parse(this.rows).barCode}e.loadData(1)}e.selectedRowKeys=[],e.selectIds=[]},close:function(){this.searchReset(0),this.visible=!1},handleSubmit:function(){var t=this;this.getSelectRows(),t.$emit("ok",t.selectRows,t.selectIds),t.searchReset(0),t.close()},getSelectRows:function(t){var e=this.dataSource,a="";this.selectRows=[];for(var s=0,i=e.length;s<i;s++)this.selectedRowKeys.includes(e[s].id)&&(this.selectRows.push(e[s]),a=a+","+e[s].batchNumber);this.selectIds=a.substring(1)},onSelectChange:function(t,e){this.selectedRowKeys=t,this.selectionRows=e},onSearch:function(){if(this.dataSource&&1===this.dataSource.length)if(this.queryParam.name===this.dataSource[0].batchNumber){var t=[];t.push(this.dataSource[0].id),this.selectedRowKeys=t,this.handleSubmit()}else this.loadData(1);else this.loadData(1)},modalFormOk:function(){this.loadData()},rowAction:function(t,e){var a=this;return{on:{click:function(){var e=[];e.push(t.id),a.selectedRowKeys=e},dblclick:function(){var e=[];e.push(t.id),a.selectedRowKeys=e,a.handleSubmit()}}}}}},l=n,d=(a("de57"),a("e607")),c=Object(d["a"])(l,s,i,!1,null,"6482e754",null);e["default"]=c.exports},de57:function(t,e,a){"use strict";a("b5ce")}}]);