(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0e1bc0"],{"7c64":function(e,t,a){"use strict";a.r(t);var s=function(){var e=this,t=e._self._c;return t("div",{ref:"container"},[t("a-modal",{staticStyle:{top:"20px",height:"95%"},attrs:{title:e.title,width:1250,visible:e.visible,getContainer:function(){return e.$refs.container},maskStyle:{top:"93px",left:"154px"},wrapClassName:e.wrapClassNameInfo(),mask:e.isDesktop(),maskClosable:!1,cancelText:"关闭"},on:{ok:e.handleOk,cancel:e.handleCancel}},["list"===e.selectType?t("div",{staticClass:"table-page-search-wrapper"},[t("a-form",{attrs:{layout:"inline"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchQuery.apply(null,arguments)}}},[t("a-row",{attrs:{gutter:24}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"单据编号",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[t("a-input",{attrs:{placeholder:"请输入单据编号查询"},model:{value:e.queryParam.number,callback:function(t){e.$set(e.queryParam,"number",t)},expression:"queryParam.number"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"商品信息",labelCol:{span:5},wrapperCol:{span:18,offset:1}}},[t("a-input",{attrs:{placeholder:"条码|名称|规格|型号"},model:{value:e.queryParam.materialParam,callback:function(t){e.$set(e.queryParam,"materialParam",t)},expression:"queryParam.materialParam"}})],1)],1),t("a-col",{attrs:{md:6,sm:24}},[t("a-form-item",{attrs:{label:"单据日期",labelCol:e.labelCol,wrapperCol:e.wrapperCol}},[t("a-range-picker",{staticStyle:{width:"100%"},attrs:{format:"YYYY-MM-DD",placeholder:["开始时间","结束时间"]},on:{change:e.onDateChange,ok:e.onDateOk},model:{value:e.queryParam.createTimeRange,callback:function(t){e.$set(e.queryParam,"createTimeRange",t)},expression:"queryParam.createTimeRange"}})],1)],1),t("span",{staticClass:"table-page-search-submitButtons",staticStyle:{float:"left",overflow:"hidden"}},[t("a-col",{attrs:{md:6,sm:24}},[t("a-button",{attrs:{type:"primary"},on:{click:e.searchQuery}},[e._v("查询")]),t("a-button",{staticStyle:{"margin-left":"8px"},on:{click:e.searchReset}},[e._v("重置")])],1)],1)],1)],1)],1):e._e(),"list"===e.selectType?t("a-table",{ref:"table",attrs:{bordered:"",size:"middle",rowKey:"id",columns:e.columns,dataSource:e.dataSource,pagination:e.ipagination,loading:e.loading,rowSelection:{selectedRowKeys:e.selectedRowKeys,onChange:e.onSelectChange,type:e.getType},customRow:e.rowAction},on:{change:e.handleTableChange},scopedSlots:e._u([{key:"numberCustomRender",fn:function(a,s){return t("span",{},[e.queryParam.purchaseStatus?e._e():t("a",{on:{click:function(t){return e.myHandleDetail(s)}}},[e._v(e._s(s.number))]),e.queryParam.purchaseStatus?t("span",[e._v(e._s(s.number))]):e._e()])}},{key:"customRenderStatus",fn:function(a,s){return[e.queryParam.purchaseStatus?e._e():["0"===s.status?t("a-tag",{attrs:{color:"red"}},[e._v("未审核")]):e._e(),"1"===s.status?t("a-tag",{attrs:{color:"green"}},[e._v("已审核")]):e._e(),"2"===s.status&&"采购订单"===e.queryParam.subType?t("a-tag",{attrs:{color:"cyan"}},[e._v("完成采购")]):e._e(),"2"===s.status&&"销售订单"===e.queryParam.subType?t("a-tag",{attrs:{color:"cyan"}},[e._v("完成销售")]):e._e(),"3"===s.status&&"采购订单"===e.queryParam.subType?t("a-tag",{attrs:{color:"blue"}},[e._v("部分采购")]):e._e(),"3"===s.status&&"销售订单"===e.queryParam.subType?t("a-tag",{attrs:{color:"blue"}},[e._v("部分销售")]):e._e()],e.queryParam.purchaseStatus?["0"===s.purchaseStatus?t("a-tag",{attrs:{color:"red"}},[e._v("未采购")]):e._e(),"2"===s.purchaseStatus&&"销售订单"===e.queryParam.subType?t("a-tag",{attrs:{color:"cyan"}},[e._v("完成采购")]):e._e(),"3"===s.purchaseStatus&&"销售订单"===e.queryParam.subType?t("a-tag",{attrs:{color:"blue"}},[e._v("部分采购")]):e._e()]:e._e()]}}],null,!1,377553899)}):e._e(),"detail"===e.selectType?t("a-table",{ref:"table",attrs:{bordered:"",size:"middle",rowKey:"id",pagination:!1,columns:e.columnsDetail,dataSource:e.dataSourceDetail,loading:e.loading,rowSelection:{selectedRowKeys:e.selectedDetailRowKeys,onChange:e.onSelectDetailChange,type:"checkbox"}},on:{change:e.handleTableChange}}):e._e(),t("bill-detail",{ref:"billDetail"})],1)],1)},i=[],l=a("9be9"),r=a("b65a"),n=a("ac0d"),o=a("4ec3"),c=a("0fea"),u=a("1f37"),d={name:"LinkBillList",mixins:[r["a"],n["b"]],components:{BillDetail:l["default"]},data:function(){return{title:"操作",visible:!1,disableMixinCreated:!0,selectedRowKeys:[],selectedDetailRowKeys:[],selectBillRows:[],selectBillDetailRows:[],showType:"basic",selectType:"list",linkNumber:"",organId:"",discountMoney:"",deposit:"",remark:"",queryParam:{number:"",materialParam:"",type:"",subType:"",status:""},labelCol:{xs:{span:24},sm:{span:8}},wrapperCol:{xs:{span:24},sm:{span:16}},columns:[{title:"",dataIndex:"organName",width:120,ellipsis:!0},{title:"单据编号",dataIndex:"number",width:130,scopedSlots:{customRender:"numberCustomRender"}},{title:"商品信息",dataIndex:"materialsList",width:280,ellipsis:!0,customRender:function(e,t,a){if(e)return e.replace(",","，")}},{title:"单据日期",dataIndex:"operTimeStr",width:145},{title:"操作员",dataIndex:"userName",width:70},{title:"数量",dataIndex:"materialCount",width:60},{title:"金额合计",dataIndex:"totalPrice",width:70},{title:"含税合计",dataIndex:"totalTaxLastMoney",width:70,customRender:function(e,t,a){return t.discountLastMoney?(t.discountMoney+t.discountLastMoney).toFixed(2):t.totalPrice}},{title:"状态",dataIndex:"status",width:70,align:"center",scopedSlots:{customRender:"customRenderStatus"}}],columnsDetail:[{title:"条码",dataIndex:"barCode",width:120},{title:"名称",dataIndex:"name",width:100,ellipsis:!0},{title:"规格",dataIndex:"standard",width:100,ellipsis:!0},{title:"型号",dataIndex:"model",width:150,ellipsis:!0},{title:"单位",dataIndex:"unit",width:50},{title:"数量",dataIndex:"operNumber",width:80},{title:"单价",dataIndex:"unitPrice",width:80},{title:"金额",dataIndex:"allPrice",width:80},{title:"税率(%)",dataIndex:"taxRate",width:80},{title:"税额",dataIndex:"taxMoney",width:80},{title:"价税合计",dataIndex:"taxLastMoney",width:80},{title:"备注",dataIndex:"remark",width:100,ellipsis:!0}],dataSource:[],dataSourceDetail:[],url:{list:"/depotHead/list"}}},computed:{getType:function(){return"radio"}},created:function(){},methods:{show:function(e,t,a,s){this.selectType="list",this.showType="basic",this.queryParam.type=e,this.queryParam.subType=t,this.queryParam.roleType=u["a"].ls.get("roleType"),this.queryParam.status=s,this.columns[0].title=a,this.model=Object.assign({},{}),this.visible=!0,this.loadData(1)},purchaseShow:function(e,t,a,s,i){this.selectType="list",this.showType="purchase",this.queryParam.type=e,this.queryParam.subType=t,this.queryParam.roleType="全部数据",this.queryParam.status=s,this.queryParam.purchaseStatus=i,this.columns[0].title=a,this.model=Object.assign({},{}),this.visible=!0,this.loadData(1)},myHandleDetail:function(e){var t=this;Object(o["U"])({number:e.number}).then((function(e){if(e&&200===e.code){var a=e.data.depotHeadType;a=a.replace("其它",""),t.$refs.billDetail.show(e.data,a),t.$refs.billDetail.title=a+"-详情"}}))},close:function(){this.$emit("close"),this.visible=!1},handleCancel:function(){this.close()},onSelectChange:function(e){this.selectedRowKeys=e},onSelectDetailChange:function(e){this.selectedDetailRowKeys=e},handleOk:function(){if("list"===this.selectType){if(this.getSelectBillRows(),this.selectType="detail",this.title="选择单据明细",this.selectBillRows&&this.selectBillRows.length>0){var e=this.selectBillRows[0];this.linkNumber=e.number,this.organId=e.organId,this.discountMoney=e.discountMoney,this.deposit=e.changeAmount-e.finishDeposit,this.remark=e.remark,this.loadDetailData(1)}}else this.selectedDetailRowKeys.length?(this.getSelectBillDetailRows(),this.$emit("ok",this.selectBillDetailRows,this.linkNumber,this.organId,this.discountMoney,this.deposit,this.remark),this.close()):this.$message.warning("抱歉，请选择单据明细！")},loadDetailData:function(e){var t=this;if(1===e&&(this.ipagination.current=1),this.selectBillRows&&this.selectBillRows.length>0){var a=this.selectBillRows[0],s={headerId:a.id,mpList:"",linkType:this.showType};this.loading=!0,Object(c["c"])("/depotItem/getDetailList",s).then((function(e){if(200===e.code){for(var a=e.data.rows,s=[],i=0;i<a.length;i++){var l=a[i];l.preNumber!==l.finishNumber?s.push(l):"采购"!==t.queryParam.subType&&"销售"!==t.queryParam.subType&&"零售"!==t.queryParam.subType||s.push(l)}t.dataSourceDetail=s,t.ipagination.total=e.data.total}510===e.code&&t.$message.warning(e.data),t.loading=!1}))}},onDateChange:function(e,t){this.queryParam.beginTime=t[0],this.queryParam.endTime=t[1]},onDateOk:function(e){},searchReset:function(){this.queryParam={type:this.queryParam.type,subType:this.queryParam.subType,status:"1,3"},this.loadData(1)},getSelectBillRows:function(){var e=this.dataSource;this.selectBillRows=[];for(var t=0,a=e.length;t<a;t++)this.selectedRowKeys.includes(e[t].id)&&this.selectBillRows.push(e[t])},getSelectBillDetailRows:function(){var e=this.dataSourceDetail;this.selectBillDetailRows=[];for(var t=0,a=e.length;t<a;t++)this.selectedDetailRowKeys.includes(e[t].id)&&this.selectBillDetailRows.push(e[t])},rowAction:function(e,t){var a=this;return{on:{click:function(){var t=[];t.push(e.id),a.selectedRowKeys=t},dblclick:function(){var t=[];t.push(e.id),a.selectedRowKeys=t,a.handleOk()}}}}}},h=d,m=a("e607"),p=Object(m["a"])(h,s,i,!1,null,"13a2076b",null);t["default"]=p.exports}}]);