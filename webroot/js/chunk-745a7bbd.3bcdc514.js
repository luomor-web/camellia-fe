(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-745a7bbd"],{"267bb":function(t,n,e){"use strict";e.r(n),e.d(n,"FinancialModalMixin",(function(){return d}));var i=e("4ec3"),o=e("0fea"),a=e("ca00"),r=e("9fb0"),c=e("1f37");function s(t,n){var e="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!e){if(Array.isArray(t)||(e=u(t))||n&&t&&"number"===typeof t.length){e&&(t=e);var i=0,o=function(){};return{s:o,n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,c=!1;return{s:function(){e=e.call(t)},n:function(){var t=e.next();return r=t.done,t},e:function(t){c=!0,a=t},f:function(){try{r||null==e.return||e.return()}finally{if(c)throw a}}}}function u(t,n){if(t){if("string"===typeof t)return l(t,n);var e=Object.prototype.toString.call(t).slice(8,-1);return"Object"===e&&t.constructor&&(e=t.constructor.name),"Map"===e||"Set"===e?Array.from(t):"Arguments"===e||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(e)?l(t,n):void 0}}function l(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,i=new Array(n);e<n;e++)i[e]=t[e];return i}var d={data:function(){return{action:"",supList:[],cusList:[],retailList:[],organList:[],personList:[],accountList:[],billStatus:"0",isCanCheck:!0,isTenant:!1,checkFlag:!0,spans:{labelCol1:{span:2},wrapperCol1:{span:22},labelCol1_5:{span:3},wrapperCol1_5:{span:21},labelCol2:{span:4},wrapperCol2:{span:20},labelCol3:{span:6},wrapperCol3:{span:18},labelCol6:{span:12},wrapperCol6:{span:12}}}},created:function(){var t=c["a"].ls.get(r["t"]);this.isTenant=t.id===t.tenantId;var n=window.screen.width;this.width=n<1500?"1200px":"1550px",this.minWidth=n<1500?1150:1500},computed:{readOnly:function(){return"add"!==this.action&&"edit"!==this.action}},methods:{addInit:function(t){var n=this;Object(o["c"])("/sequence/buildNumber").then((function(e){e&&200===e.code&&n.form.setFieldsValue({billNo:t+e.data.defaultNumber})})),this.$nextTick((function(){n.form.setFieldsValue({billTime:Object(a["h"])(),totalPrice:0,discountMoney:0,changeAmount:0})})),this.$nextTick((function(){Object(i["cb"])({}).then((function(t){if(t&&200===t.code){var e,i=s(t.data.accountList);try{for(i.s();!(e=i.n()).done;){var o=e.value;o.isDefault&&n.form.setFieldsValue({accountId:o.id})}}catch(a){i.e(a)}finally{i.f()}}}))}))},initSystemConfig:function(){var t=this;Object(i["fb"])().then((function(n){if(200===n.code&&n.data){var e=n.data.multiBillType,i=n.data.multiLevelApprovalFlag;t.checkFlag=Object(a["f"])(e,i,t.prefixNo)}}))},initSupplier:function(){var t=this;Object(i["Y"])({}).then((function(n){n&&(t.supList=n)}))},initCustomer:function(){var t=this;Object(i["V"])({}).then((function(n){n&&(t.cusList=n)}))},initOrgan:function(){var t=this;Object(i["W"])({}).then((function(n){n&&(t.organList=n)}))},initRetail:function(){var t=this;Object(i["X"])({}).then((function(n){n&&(t.retailList=n)}))},initPerson:function(){var t=this;Object(i["ob"])({type:"财务员"}).then((function(n){n&&200===n.code&&(t.personList=n.data.personList)}))},initInOutItem:function(t){var n=this;Object(i["ab"])({type:t}).then((function(t){if(t){var e,i=s(n.accountTable.columns);try{for(i.s();!(e=i.n()).done;){var o=e.value;if("inOutItemId"==o.key){o.options=[];for(var a=0;a<t.length;a++){var r={};r.value=t[a].id+"",r.text=t[a].name,r.title=t[a].name,o.options.push(r)}}}}catch(c){i.e(c)}finally{i.f()}}}))},initAccount:function(){var t=this;Object(i["cb"])({}).then((function(n){n&&200===n.code&&(t.accountList=n.data.accountList)}))},initDetailAccount:function(){var t=this;Object(i["cb"])({}).then((function(n){if(n&&200===n.code){var e,i=n.data.accountList,o=s(t.accountTable.columns);try{for(o.s();!(e=o.n()).done;){var a=e.value;if("accountId"==a.key){a.options=[];for(var r=0;r<i.length;r++){var c={};c.value=i[r].id+"",c.text=i[r].name,c.title=i[r].name,a.options.push(c)}}}}catch(u){o.e(u)}finally{o.f()}}}))},onChangeOrgan:function(t){this.accountTable.dataSource=[]},addSupplier:function(){this.$refs.vendorModalForm.add(),this.$refs.vendorModalForm.title="新增",this.$refs.vendorModalForm.disableSubmit=!1},addCustomer:function(){this.$refs.customerModalForm.add(),this.$refs.customerModalForm.title="新增客户（提醒：如果找不到新添加的客户，请到用户管理检查是否分配了该客户权限）",this.$refs.customerModalForm.disableSubmit=!1},addAccount:function(){this.$refs.accountModalForm.add(),this.$refs.accountModalForm.title="新增结算账户",this.$refs.accountModalForm.disableSubmit=!1},addPerson:function(){this.$refs.personModalForm.add(),this.$refs.personModalForm.title="新增经手人",this.$refs.personModalForm.disableSubmit=!1},vendorModalFormOk:function(){this.initSupplier()},customerModalFormOk:function(){this.initCustomer()},accountModalFormOk:function(){this.initAccount()},personModalFormOk:function(){this.initPerson()},onValueChange:function(t){var n=this,e=(t.type,t.row,t.column),i=(t.value,t.target);switch(e.key){case"eachAmount":i.recalcAllStatisticsColumns(),n.autoChangeAmount(i);break}},autoChangeAmount:function(t){var n=this,e=t.statisticsColumns.eachAmount-0,i=this.form.getFieldValue("discountMoney")-0;i||(i=0);var o=(e-i).toFixed(2);this.$nextTick((function(){n.form.setFieldsValue({totalPrice:e,changeAmount:o})}))},onChangeDiscountMoney:function(t){var n=this,e=t.target.value-0,i=this.form.getFieldValue("totalPrice")-0,o=(i-e).toFixed(2);this.$nextTick((function(){n.form.setFieldsValue({changeAmount:o})}))},debtBillListOk:function(t){t&&t.length>0&&this.requestSubTableDataEx(t,this.accountTable)},requestSubTableDataEx:function(t,n,e){var i=this;n.loading=!0;for(var o=[],a=0,r=0;r<t.length;r++){var c=t[r];c.billNumber=c.number,c.needDebt=c.needDebt,c.eachAmount=c.debt,0!=c.eachAmount&&(a+=c.eachAmount-0,o.push(c))}n.dataSource=o,this.$nextTick((function(){i.form.setFieldsValue({totalPrice:a,changeAmount:a})})),"function"===typeof e&&e(res),n.loading=!1},selectBeginNeed:function(t){var n=this,e="供应商"===t?"付款":"收款",i=this.form.getFieldValue("organId");i?this.$confirm({title:"确认操作",content:"是否选择期初金额，对期初进行"+e+"?",onOk:function(){var t=[],e={billNumber:"QiChu"};Object(o["c"])("/supplier/getBeginNeedByOrganId",{organId:i}).then((function(i){if(200===i.code){e.needDebt=i.data.needDebt?i.data.needDebt:0,e.finishDebt=i.data.finishDebt,e.eachAmount=i.data.eachAmount,t.push(e),n.accountTable.dataSource=t;var o=e.eachAmount;n.$nextTick((function(){n.form.setFieldsValue({totalPrice:o,changeAmount:o})}))}else n.$message.info(i.data)}))}}):n.$message.warning("请选择"+t+"！")},handleOkAndCheck:function(){this.billStatus="1",this.handleOk()},handleWorkflow:function(){var t=this;this.model&&this.model.billNo?Object(i["pb"])({platformKey:"send_workflow_url"}).then((function(n){if(n&&200===n.code){var e=n.data.platformValue+"?no="+t.model.billNo+"&type=2";t.$refs.modalWorkflow.show(t.model,e,320),t.$refs.modalWorkflow.title="发起流程"}})):this.$message.warning("请先保存单据后再提交流程！")}}}}}]);